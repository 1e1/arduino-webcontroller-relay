<html>
<head>
<style>
h2{
    background:#333;
    color:#ddd;
    padding:0 1em
}

input{
    width:280px;
    font-family:monospace
}

button{
    float:right
}
</style>
<script>
o={};
f=(a,u)=>{
    x=new XMLHttpRequest();
    x.open(a,`/cfg/${u}.json`,0);
    x.send(o[u]);
    if(200==x.status)
        o[u]=JSON.parse(x.response)
};
f('GET','mac');f('GET','g');f('GET','w');f('GET','d');f('GET','r');
g=()=>{
    document.querySelectorAll('[data-o]').forEach((a,u)=>{
        a.value=a.dataset.o.length>2?o[a.dataset.o[0]][a.dataset.o[2]][a.dataset.o[1]]:o[a.dataset.o[0]][a.dataset.o[1]];
        a.onchange=()=>a.dataset.o.length>2?o[a.dataset.o[0]][a.dataset.o[2]][a.dataset.o[1]]=a.value:o[a.dataset.o[0]][a.dataset.o[1]]=a.value;
    });
};
w=()=>{
    h='';
    u=o.w.length;
    o.w.forEach((a,u)=>{
        h+=`<tr><td><input type=text maxlength=32 data-o=wn${u}></td><td><input type=password minlength=8 maxlength=63 data-o=wp${u}></td><td><button onclick="o.w.splice(${u},1);w()">-</button></td></tr>`;
    });
    h+=`<tr><td><input type=text maxlength=32 id=wn></td><td><input type=password minlength=8 maxlength=63 id=wp></td><td><button onclick="o.w[${u}]={'n':document.getElementById('wn').value,'p':document.getElementById('wp').value};w()">+</button></td></tr>`;
    document.getElementById('w').innerHTML=h;
};
d=()=>{
    h='';
    u=o.d.length;
    o.d.forEach((a,u)=>{
        h+=`<tr><td><input type=text maxlength=32 data-o=dn${u}></td><td><input type=text pattern="([0-9A-F]{2}:){5}[0-9A-F]{2}" data-o=dm${u}></td><td><input maxlength=8 type=text data-o=dc${u}></td><td><button onclick="o.d.splice(${u},1);d()">-</button></td></tr>`;
    });
    h+=`<tr><td><input type=text maxlength=32 id=dn></td><td><input type=text pattern="([0-9A-F]{2}:){5}[0-9A-F]{2}" value="${o.mac}" id=dm></td><td><input maxlength=8 type=text id=dc></td><td><button onclick="o.d[${u}]={'n':document.getElementById('dn').value,'m':document.getElementById('dm').value};,'c':document.getElementById('dc').value};d()">+</button></td></tr>`;
    document.getElementById('d').innerHTML=h;
};
r=()=>{
    h='';
    u=o.r.length;
    o.r.forEach((a,u)=>{
        h+=`<tr><td><input type=text maxlength=32 data-o=rn${u}></td><td><input type=number data-o=ri${u}></td><td><input type=checkbox onclick="this.value=1*this.checked" ${a.c?"checked":''} data-o=rc${u}></td><td><button onclick="o.r.splice(${u},1);r()">-</button></td></tr>`;
    });
    h+=`<tr><td><input type=text maxlength=32 id=rn></td><td><input type=number id=ri></td><td><input type=checkbox onclick="this.value=1*this.checked" id=rc></td><td><button onclick="o.r[${u}]={'n':document.getElementById('rn').value,'i':document.getElementById('ri').value};,'c':document.getElementById('rc').value};r()">+</button></td></tr>`;
    document.getElementById('r').innerHTML=h;
};
s=(a,u)=>{
    f('POST',a);
    u()
};
</script>
</head>
<body onload="w();d();r();g()">
<h2>access point <button onclick="s('g',g)">save</button></h2>
<table>
    <tbody id=g>
        <tr>
            <td>BasicAuth</td>
            <td><input type=password minlength=8 maxlength=63 data-o=ga></td>
        </tr>
        <tr>
            <td>SSID</td>
            <td><input type=text maxlength=32 data-o=gn></td>
        </tr>
        <tr>
            <td>password</td>
            <td><input type=password minlength=8 maxlength=63 data-o=gp></td>
        </tr>
    </tbody>
</table>

<h2>wifis <button onclick="s('w',w)">save</button></h2>
<table>
    <thead>
        <tr>
            <td>SSID</td>
            <td>password</td>
            <td></td>
        </tr>
    </thead>
<tbody id=w>
</tbody>
</table>

<h2>devices <button onclick="s('d',d)">save</button></h2>
<table>
    <thead>
        <tr>
            <td>name</td>
            <td>MAC</td>
            <td>serial command</td>
            <td></td>
        </tr>
    </thead>
<tbody id=d>
</tbody>
</table>

<h2>relays <button onclick="s('r',r)">save</button></h2>
<table>
    <thead>
        <tr>
            <td>name</td>
            <td>id</td>
            <td>isNC</td>
            <td></td>
        </tr>
    </thead>
<tbody id=r>
</tbody>
</table>
